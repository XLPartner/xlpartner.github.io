import{c as $,u as Y,aA as G,g as R,s as H,aB as J,a as f,N as Z,h as x,a7 as T,aC as ee,aa as te,x as N,r as E,E as ne,z as ae,aD as ie,aE as le,aF as oe,aG as ue,aH as re,aI as se,aJ as K,aK as ce,aL as de,D as fe,Q as me,aM as ve,aN as ge,o as he,d as be,aO as ye,f as Se,aP as xe,aQ as Fe}from"./index-igPNiqby.js";import{h as pe}from"./format-nZn2EDmM.js";import{a as M}from"./user-CsLZHPLc.js";const Ce={xs:8,sm:10,md:14,lg:20,xl:24},qe=$({name:"QChip",props:{...Y,...G,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:d,emit:S}){const{proxy:{$q:F}}=R(),u=H(e,F),c=J(e,Ce),m=f(()=>e.selected===!0||e.icon!==void 0),q=f(()=>e.selected===!0?e.iconSelected||F.iconSet.chip.selected:e.icon),z=f(()=>e.iconRemove||F.iconSet.chip.remove),k=f(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),D=f(()=>{const n=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(n?` text-${n} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(k.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(u.value===!0?" q-chip--dark q-dark":"")}),C=f(()=>{const n=e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0},_={...n,role:"button","aria-hidden":"false","aria-label":e.removeAriaLabel||F.lang.label.remove};return{chip:n,remove:_}});function P(n){n.keyCode===13&&a(n)}function a(n){e.disable||(S("update:selected",!e.selected),S("click",n))}function h(n){(n.keyCode===void 0||n.keyCode===13)&&(N(n),e.disable===!1&&(S("update:modelValue",!1),S("remove")))}function r(){const n=[];k.value===!0&&n.push(x("div",{class:"q-focus-helper"})),m.value===!0&&n.push(x(T,{class:"q-chip__icon q-chip__icon--left",name:q.value}));const _=e.label!==void 0?[x("div",{class:"ellipsis"},[e.label])]:void 0;return n.push(x("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},ee(d.default,_))),e.iconRight&&n.push(x(T,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&n.push(x(T,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:z.value,...C.value.remove,onClick:h,onKeyup:h})),n}return()=>{if(e.modelValue===!1)return;const n={class:D.value,style:c.value};return k.value===!0&&Object.assign(n,C.value.chip,{onClick:a,onKeyup:P}),Z("div",n,r(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[te,e.ripple]])}}});function I(e,d,S,F){const u=[];return e.forEach(c=>{F(c)===!0?u.push(c):d.push({failedPropValidation:S,file:c})}),u}function B(e){e&&e.dataTransfer&&(e.dataTransfer.dropEffect="copy"),N(e)}const ke={multiple:Boolean,accept:String,capture:String,maxFileSize:[Number,String],maxTotalSize:[Number,String],maxFiles:[Number,String],filter:Function},_e=["rejected"];function Ve({editable:e,dnd:d,getFileInput:S,addFilesToQueue:F}){const{props:u,emit:c,proxy:m}=R(),q=E(null),z=f(()=>u.accept!==void 0?u.accept.split(",").map(t=>(t=t.trim(),t==="*"?"*/":(t.endsWith("/*")&&(t=t.slice(0,t.length-1)),t.toUpperCase()))):null),k=f(()=>parseInt(u.maxFiles,10)),D=f(()=>parseInt(u.maxTotalSize,10));function C(t){if(e.value)if(t!==Object(t)&&(t={target:null}),t.target!==null&&t.target.matches('input[type="file"]')===!0)t.clientX===0&&t.clientY===0&&ne(t);else{const o=S();o&&o!==t.target&&o.click(t)}}function P(t){e.value&&t&&F(null,t)}function a(t,o,v,b){let l=Array.from(o||t.target.files);const y=[],A=()=>{y.length!==0&&c("rejected",y)};if(u.accept!==void 0&&z.value.indexOf("*/")===-1&&(l=I(l,y,"accept",s=>z.value.some(g=>s.type.toUpperCase().startsWith(g)||s.name.toUpperCase().endsWith(g))),l.length===0))return A();if(u.maxFileSize!==void 0){const s=parseInt(u.maxFileSize,10);if(l=I(l,y,"max-file-size",g=>g.size<=s),l.length===0)return A()}if(u.multiple!==!0&&l.length!==0&&(l=[l[0]]),l.forEach(s=>{s.__key=s.webkitRelativePath+s.lastModified+s.name+s.size}),b===!0){const s=v.map(g=>g.__key);l=I(l,y,"duplicate",g=>s.includes(g.__key)===!1)}if(l.length===0)return A();if(u.maxTotalSize!==void 0){let s=b===!0?v.reduce((g,O)=>g+O.size,0):0;if(l=I(l,y,"max-total-size",g=>(s+=g.size,s<=D.value)),l.length===0)return A()}if(typeof u.filter=="function"){const s=u.filter(l);l=I(l,y,"filter",g=>s.includes(g))}if(u.maxFiles!==void 0){let s=b===!0?v.length:0;if(l=I(l,y,"max-files",()=>(s++,s<=k.value)),l.length===0)return A()}if(A(),l.length!==0)return l}function h(t){B(t),d.value!==!0&&(d.value=!0)}function r(t){N(t),(t.relatedTarget!==null||ae.is.safari!==!0?t.relatedTarget!==q.value:document.elementsFromPoint(t.clientX,t.clientY).includes(q.value)===!1)===!0&&(d.value=!1)}function n(t){B(t);const o=t.dataTransfer.files;o.length!==0&&F(null,o),d.value=!1}function _(t){if(d.value===!0)return x("div",{ref:q,class:`q-${t}__dnd absolute-full`,onDragenter:B,onDragover:B,onDragleave:r,onDrop:n})}return Object.assign(m,{pickFiles:C,addFiles:P}),{pickFiles:C,addFiles:P,onDragover:h,onDragleave:r,processFiles:a,getDndNode:_,maxFilesNumber:k,maxTotalSizeNumber:D}}const Ae=$({name:"QFile",inheritAttrs:!1,props:{...ie,...le,...ke,modelValue:[File,FileList,Array],append:Boolean,useChips:Boolean,displayValue:[String,Number],tabindex:{type:[String,Number],default:0},counterLabel:Function,inputClass:[Array,String,Object],inputStyle:[Array,String,Object]},emits:[...oe,..._e],setup(e,{slots:d,emit:S,attrs:F}){const{proxy:u}=R(),c=ue(),m=E(null),q=E(!1),z=re(e),{pickFiles:k,onDragover:D,onDragleave:C,processFiles:P,getDndNode:a}=Ve({editable:c.editable,dnd:q,getFileInput:w,addFilesToQueue:L}),h=se(e),r=f(()=>Object(e.modelValue)===e.modelValue?"length"in e.modelValue?Array.from(e.modelValue):[e.modelValue]:[]),n=f(()=>K(r.value)),_=f(()=>r.value.map(i=>i.name).join(", ")),t=f(()=>pe(r.value.reduce((i,p)=>i+p.size,0))),o=f(()=>({totalSize:t.value,filesNumber:r.value.length,maxFiles:e.maxFiles})),v=f(()=>({tabindex:-1,type:"file",title:"",accept:e.accept,capture:e.capture,name:z.value,...F,id:c.targetUid.value,disabled:c.editable.value!==!0})),b=f(()=>"q-file q-field--auto-height"+(q.value===!0?" q-file--dnd":"")),l=f(()=>e.multiple===!0&&e.append===!0);function y(i){const p=r.value.slice();p.splice(i,1),s(p)}function A(i){const p=r.value.indexOf(i);p!==-1&&y(p)}function s(i){S("update:modelValue",e.multiple===!0?i:i[0])}function g(i){i.keyCode===13&&fe(i)}function O(i){(i.keyCode===13||i.keyCode===32)&&k(i)}function w(){return m.value}function L(i,p){const V=P(i,p,r.value,l.value),Q=w();Q!=null&&(Q.value=""),V!==void 0&&((e.multiple===!0?e.modelValue&&V.every(X=>r.value.includes(X)):e.modelValue===V[0])||s(l.value===!0?r.value.concat(V):V))}function j(){return[x("input",{class:[e.inputClass,"q-file__filler"],style:e.inputStyle})]}function U(){if(d.file!==void 0)return r.value.length===0?j():r.value.map((p,V)=>d.file({index:V,file:p,ref:this}));if(d.selected!==void 0)return r.value.length===0?j():d.selected({files:r.value,ref:this});if(e.useChips===!0)return r.value.length===0?j():r.value.map((p,V)=>x(qe,{key:"file-"+V,removable:c.editable.value,dense:!0,textColor:e.color,tabindex:e.tabindex,onRemove:()=>{y(V)}},()=>x("span",{class:"ellipsis",textContent:p.name})));const i=e.displayValue!==void 0?e.displayValue:_.value;return i.length!==0?[x("div",{class:e.inputClass,style:e.inputStyle,textContent:i})]:j()}function W(){const i={ref:m,...v.value,...h.value,class:"q-field__input fit absolute-full cursor-pointer",onChange:L};return e.multiple===!0&&(i.multiple=!0),x("input",i)}return Object.assign(c,{fieldClass:b,emitValue:s,hasValue:n,inputRef:m,innerValue:r,floatingLabel:f(()=>n.value===!0||K(e.displayValue)),computedCounter:f(()=>{if(e.counterLabel!==void 0)return e.counterLabel(o.value);const i=e.maxFiles;return`${r.value.length}${i!==void 0?" / "+i:""} (${t.value})`}),getControlChild:()=>a("file"),getControl:()=>{const i={ref:c.targetRef,class:"q-field__native row items-center cursor-pointer",tabindex:e.tabindex};return c.editable.value===!0&&Object.assign(i,{onDragover:D,onDragleave:C,onKeydown:g,onKeyup:O}),x("div",i,[W()].concat(U()))}}),Object.assign(u,{removeAtIndex:y,removeFile:A,getNativeElement:()=>m.value}),ce(u,"nativeEl",()=>m.value),de(c)}}),Ie=$({name:"QForm",props:{autofocus:Boolean,noErrorFocus:Boolean,noResetFocus:Boolean,greedy:Boolean,onSubmit:Function},emits:["reset","validationSuccess","validationError"],setup(e,{slots:d,emit:S}){const F=R(),u=E(null);let c=0;const m=[];function q(a){const h=typeof a=="boolean"?a:e.noErrorFocus!==!0,r=++c,n=(o,v)=>{S(`validation${o===!0?"Success":"Error"}`,v)},_=o=>{const v=o.validate();return typeof v.then=="function"?v.then(b=>({valid:b,comp:o}),b=>({valid:!1,comp:o,err:b})):Promise.resolve({valid:v,comp:o})};return(e.greedy===!0?Promise.all(m.map(_)).then(o=>o.filter(v=>v.valid!==!0)):m.reduce((o,v)=>o.then(()=>_(v).then(b=>{if(b.valid===!1)return Promise.reject(b)})),Promise.resolve()).catch(o=>[o])).then(o=>{if(o===void 0||o.length===0)return r===c&&n(!0),!0;if(r===c){const{comp:v,err:b}=o[0];if(b!==void 0&&console.error(b),n(!1,v),h===!0){const l=o.find(({comp:y})=>typeof y.focus=="function"&&ye(y.$)===!1);l!==void 0&&l.comp.focus()}}return!1})}function z(){c++,m.forEach(a=>{typeof a.resetValidation=="function"&&a.resetValidation()})}function k(a){a!==void 0&&N(a);const h=c+1;q().then(r=>{h===c&&r===!0&&(e.onSubmit!==void 0?S("submit",a):a!==void 0&&a.target!==void 0&&typeof a.target.submit=="function"&&a.target.submit())})}function D(a){a!==void 0&&N(a),S("reset"),Se(()=>{z(),e.autofocus===!0&&e.noResetFocus!==!0&&C()})}function C(){xe(()=>{if(u.value===null)return;const a=u.value.querySelector("[autofocus][tabindex], [data-autofocus][tabindex]")||u.value.querySelector("[autofocus] [tabindex], [data-autofocus] [tabindex]")||u.value.querySelector("[autofocus], [data-autofocus]")||Array.prototype.find.call(u.value.querySelectorAll("[tabindex]"),h=>h.tabIndex!==-1);a?.focus({preventScroll:!0})})}me(Fe,{bindComponent(a){m.push(a)},unbindComponent(a){const h=m.indexOf(a);h!==-1&&m.splice(h,1)}});let P=!1;return ve(()=>{P=!0}),ge(()=>{P===!0&&e.autofocus===!0&&C()}),he(()=>{e.autofocus===!0&&C()}),Object.assign(F.proxy,{validate:q,resetValidation:z,submit:k,reset:D,focus:C,getValidationComponents:()=>m}),()=>x("form",{class:"q-form",ref:u,onSubmit:k,onReset:D},be(d.default))}});function Ne(e){const d=new FormData;return d.append("file",e),M.post("/general/upload/single",d)}function je(){return M.get("/system/init/index")}export{Ae as Q,Ie as a,je as i,Ne as u};
